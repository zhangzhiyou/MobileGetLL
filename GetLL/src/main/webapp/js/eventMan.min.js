function EventMan(){this.loginMobile_="";this.mobileReg_=/^1\d{10}$/;this.mobileGroups=[];this.remainTimes_=0;this.nickName_="";this.getPasswordPath_="/ajax/getPasswordDo.action";this.getOtherPasswordPath_="/ajax/getOtherPassword.action";this.refreshNickName_="/ajax/refreshNickName.action";this.pwdIntervalIndex_=-1;this.pwdIntervalIndex2_=-1}EventMan.prototype.init=function(){var a=this;$("#mobile").keydown(function(b){var c=b.which;if(c==13){$("#loginDo").click()}});$("#password").keydown(function(b){var c=b.which;if(c==13){$("#loginDo").click()}});$("#mobile").keyup(function(){$(this).val(a.parseMobileFormat($(this).val()))});$("#loginDo").click(function(){a.loginDo(function(){locationPage("/home.action")})});$("#cancelSetting").click(function(){a.refresh()});$("#getRegisterCode").click(function(){$.getJSON("/ajax/getRegisterCode.action",function(b){var c=b.result.registerCode;$("#registerCode").val(c)})});$("#setRegisterCodeDo").click(function(){a.loginDo()});$("#btShakeNow").click(function(){if(score.remainTimes_<=0){alert("您今天剩余摇奖次数为0,\n提示: 系统每天6点准时为您摇奖");return}a.shakeNow()});$("#leavesDay").click(function(){if($("#leavesDay").text().indexOf("点我续期")>0){$.post("/ajax/freshRegisterCode.action?r="+Math.random(),{},function(b){if(b.status!="ok"){alert("续期失败，请刷新后重试")}else{$("#leavesDay").text(b.result.ttl);alert("恭喜，续期成功")}})}});$("#getPassword").unbind("click");$("#getPassword").click(function(){a.getPassword()})};EventMan.prototype.parseMobile=function(a){a=a.replace(/\-/g,"");if(a.indexOf("+86")==0){a=a.substr(3)}else{if(a.indexOf("86")==0){a=a.substr(2)}}return a};EventMan.prototype.parseMobileFormat=function(a){var b=this;a=a.replace(/[^0-9]+/g,"");if(!/^[0-9]*$/g.test(a)){a=b.parseMobileFormat(a)}return a};EventMan.prototype.getPassword=function(b){var c=this;var a=c.parseMobile($.trim($("#mobile").val()));if(!a){$("#message").html("手机号不能为空");return}else{if(!c.mobileReg_.test(a)){$("#message").html("必须输入山东移动手机号");return}}var d=c.getPasswordPath_+"?";if(b=="other"){d=c.getOtherPasswordPath_+"?isLogin=true&"}$.post(d+"r="+Math.random(),{mobile:a},function(e){var g="";if(e.status!="ok"){g=e.message}$("#message").html(g);var f=parseInt(e.result.seconds);if(f>0){$("#getPassword").hide();$("#sendStatus").show();c.pwdInterval(f)}},"json")};EventMan.prototype.pwdInterval=function(d){var b=this;var c=$("#seconds");c.html(d);var a=setInterval(function(){var e=parseInt(c.html());e=e-1;c.html(e);if(e<=0){clearInterval(b.pwdIntervalIndex_);$("#getPassword").show();$("#sendStatus").hide()}},1000);b.pwdIntervalIndex_=parseInt(a)};EventMan.prototype.pwdInterval2=function(e,b){var c=this;var d=$("#seconds"+b);d.html(e);var a=setInterval(function(){var f=parseInt(d.html());f=f-1;d.html(f);if(f<=0){clearInterval(c.pwdIntervalIndex2_);$("#getPassword"+b).show();$("#sendStatus"+b).hide()}},1000);c.pwdIntervalIndex2_=parseInt(a)};EventMan.prototype.checkLogin=function(c,a){var b=this;$.getJSON("/ajax/loadLoginedMobile.action?r="+new Date().getTime(),{},function(d){if(d.status!="ok"){alert("登录失败");return}b.loginMobile_=d.result.loginMobile;b.nickName_=d.result.nickName;b.mobileGroups=d.result.mobileGroups;if(b.loginMobile_){if(c){c(d)}}else{if(a){a(d)}}})};EventMan.prototype.renderMobileGroups=function(a){a=a||this.mobileGroups;var d=[];if(a){for(var c=0;c<a.length;c++){var b=a[c];d.push('<li><a href="/changeLoginMobile?mobile='+b+'">'+b+"</a></li>")}}d.push('<li class="divider"></li>');d.push('<li><a href="#modal-mobile-group" data-toggle=\'modal\'><i class="glyphicon glyphicon-plus"></i> 绑定手机号</a></li>');$("#mobileGroups").html(d.join("\n"))};EventMan.prototype.loginDo=function(f){var d=this;var c=d.parseMobileFormat($.trim($("#mobile").val()));var b=$.trim($("#password").val());var a=$("#message");if(!c){a.html("手机号不能为空哦");return}else{if(!d.mobileReg_.test(c)){a.html("要输入山东移动手机号哦");return}}var e={mobile:c,password:b};$.post("/ajax/login.action?r="+Math.random(),e,function(g){if(g.status!="ok"){if(g.errorId==0){$("#passwordContent").show()}a.html(g.message);return}else{if(f){f(g)}}})};EventMan.prototype.getPassword2=function(d,b,c){var e=this;var a=e.parseMobile($.trim($("#mobile"+d).val()));if(c){if(!a){$("#message"+d).html(e.tip_.emptyMobile);$("#message"+d).show();return}else{if(!e.mobileReg_.test(a)){$("#message"+d).html(e.tip_.notShangDongMobile);$("#message"+d).show();return}}}var f=e.getOtherPasswordPath_+"?isLogin="+b+"&mobile="+a+"&r="+new Date().getTime();$.post(f,{type:d},function(g){var i="";if(g.status!="ok"){i=g.message}$("#message"+d).html(i);var h=parseInt(g.result.seconds);if(h>0){if($("#getPassword"+d)){$("#getPassword"+d).hide()}if($("#sendStatus"+d)){$("#sendStatus"+d).show()}e.pwdInterval2(h,d)}},"json")};EventMan.prototype.refreshNickName=function(){var a=this;var b=a.refreshNickName_;$.post(b+"?r="+Math.random(),{},function(c){if(c.status=="ok"){a.nickName_=c.result.nickname}},"json")};EventMan.prototype.shakeNow=function(){var a=this;$.post("/ajax/shakeNow.action",{},function(b){if(b.status!="ok"){alert("网络错误")}else{alert("正在为您摇奖，请稍等刷新查看\n提示: 系统每天6点准时为您摇奖");a.refresh()}})};EventMan.prototype.refresh=function(){location.href=location.href};EventMan.prototype.isLogin=function(){return this.loginMobile_?true:false};var eventMan=new EventMan();eventMan.init();